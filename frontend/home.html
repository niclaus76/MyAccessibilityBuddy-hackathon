<!DOCTYPE html>
<!-- Version: 2025-12-09 - OAuth2 Redirect Mode -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>My Accessibility Buddy</title>
    <!-- Bootstrap Italia CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-italia@2.8.2/dist/css/bootstrap-italia.min.css" rel="stylesheet">
    <style>
        /* Skip to main content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #0066cc;
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 100;
            font-weight: bold;
        }
        .skip-link:focus {
            top: 0;
            outline: 3px solid #ffdd00;
            outline-offset: 2px;
        }
        /* Improved focus indicators */
        button:focus-visible,
        select:focus-visible,
        input:focus-visible,
        textarea:focus-visible,
        [tabindex]:focus-visible {
            outline: 3px solid #0066cc;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header>
        <div class="container py-5">
        <!-- Header -->
        <!-- Logo + Title centered in limited width -->
        <div class="row justify-content-center mb-1">
            <div class="col-12 col-md-8 text-center">
                <div class="mb-2">
                    <img src="assets/Buddy-Logo_no_text.png" alt="My Accessibility Buddy Logo" style="width:96px;height:96px;">
                </div>
                <h1 class="mb-0" style="font-size: 1.75rem;">My Accessibility Buddy</h1>
            </div>
        </div>

        <!-- FULL-WIDTH CENTERED INTRO TEXT -->
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 text-center">
                <p>AI tool for creating WCAG 2.2-compliant alt text. Choose your language,
                    upload an image, and optionally provide context.</p>

                <p><strong>For testing purposes only:</strong> Use with ECB-PUBLIC images.
                    Avoid uploading personal or sensitive data. AI suggestions require human
                    review before use.</p>
            </div>
        </div>
        </div>
    </header>

    <main id="main-content">
        <div class="container py-4">

    <!-- Model Selection -->
    <div class="row justify-content-center mb-4">
        <div class="col-12 col-md-8">
            <div class="d-flex align-items-center">
                <label for="modelSelect" class="form-label fw-bold me-3 mb-0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-1" style="vertical-align: text-bottom;" aria-hidden="true">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Model
                </label>
                <div class="flex-grow-1">
                    <select class="form-select" id="modelSelect" name="model" required>
                        <option value="openai-gpt4o" selected>OpenAI GPT-4o</option>
                        <option value="ecb-llm-gpt4o">ECB-LLM GPT-4o</option>
                        <option value="ecb-llm-gpt-5.1">ECB-LLM GPT-5.1</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Language Selection -->
    <div class="row justify-content-center mb-4">
        <div class="col-12 col-md-8">
            <div class="d-flex align-items-center">
                <label for="languageSelect" class="form-label fw-bold me-3 mb-0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-1" style="vertical-align: text-bottom;" aria-hidden="true">
                        <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/>
                    </svg>
                    Language
                </label>
                <div class="flex-grow-1">
                    <select class="form-select" id="languageSelect" name="language" required>
                        <option value="bg">Български (Bulgarian)</option>
                        <option value="cs">Čeština (Czech)</option>
                        <option value="da">Dansk (Danish)</option>
                        <option value="de">Deutsch (German)</option>
                        <option value="el">Ελληνικά (Greek)</option>
                        <option value="en" selected>English</option>
                        <option value="es">Español (Spanish)</option>
                        <option value="et">Eesti keel (Estonian)</option>
                        <option value="fi">Suomi (Finnish)</option>
                        <option value="fr">Français (French)</option>
                        <option value="ga">Gaeilge (Irish)</option>
                        <option value="hr">Hrvatski (Croatian)</option>
                        <option value="hu">Magyar (Hungarian)</option>
                        <option value="it">Italiano (Italian)</option>
                        <option value="lt">Lietuvių (Lithuanian)</option>
                        <option value="lv">Latviešu (Latvian)</option>
                        <option value="mt">Malti (Maltese)</option>
                        <option value="nl">Nederlands (Dutch)</option>
                        <option value="pl">Polski (Polish)</option>
                        <option value="pt">Português (Portuguese)</option>
                        <option value="ro">Română (Romanian)</option>
                        <option value="sk">Slovenčina (Slovak)</option>
                        <option value="sl">Slovenščina (Slovenian)</option>
                        <option value="sv">Svenska (Swedish)</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Section -->
    <div class="row justify-content-center mb-4">
        <div class="col-12 col-md-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="row">
                        <!-- Image Upload Column -->
                        <div class="col-12 col-md-6 mb-4 mb-md-0">
                            <h2 class="h5 card-title mb-3" id="uploadTitle">
                                Upload an image
                                <button type="button" class="btn btn-link p-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Supported formats: JPG, JPEG, PNG, GIF, WEBP, BMP, SVG, TIFF" aria-label="Information about supported image formats" style="vertical-align: baseline; min-width: 24px; min-height: 24px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="color: #0066cc;" aria-hidden="true">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
                                    </svg>
                                </button>
                            </h2>

                            <!-- Upload Area with Drag & Drop -->
                            <div class="upload-area border-2 border-dashed rounded p-3 text-center mb-3" id="uploadDragdrop" style="border-color: #0066cc; background-color: #f0f6fc; cursor: pointer; transition: all 0.3s;">
                                <div class="upload-icon mb-2">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #0066cc;">
                                        <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" fill="currentColor"/>
                                    </svg>
                                </div>
                                <div class="upload-text">
                                    <p class="mb-2" id="uploadText">
                                        <strong>Drag image here</strong> or
                                    </p>
                                    <button type="button" class="btn btn-primary btn-sm mb-2" id="browseBtn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-1">
                                            <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                                        </svg>
                                        <span id="browseBtnText">Select image</span>
                                    </button>
                                </div>
                                <label for="fileInput" class="visually-hidden">Upload image file</label>
                                <input type="file" name="upload" id="fileInput" accept="image/*" style="display: none;" aria-describedby="uploadTitle">
                            </div>

                            <!-- Image preview -->
                            <div class="text-center d-none" id="previewContainer">
                                <img id="previewImage" class="img-fluid rounded" style="max-height: 150px;" alt="Uploaded image preview">
                                <div class="mt-2">
                                    <button type="button" class="btn btn-outline-danger btn-sm" id="removeImage">
                                        <svg class="icon icon-sm me-1"><use href="/bootstrap-italia/dist/svg/sprites.svg#it-delete"></use></svg>
                                        <span id="removeText">Remove</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Context Upload Column -->
                        <div class="col-12 col-md-6">
                            <h2 class="h5 card-title mb-3" id="contextLabel">
                                Context File
                                <button type="button" class="btn btn-link p-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Supported format: TXT file" aria-label="Information about supported context file format" style="vertical-align: baseline; min-width: 24px; min-height: 24px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="color: #17324d;" aria-hidden="true">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
                                    </svg>
                                </button>
                            </h2>

                            <!-- Upload Area with Drag & Drop -->
                            <div class="upload-area border-2 border-dashed rounded p-3 text-center mb-3" id="contextDragdrop" style="border-color: #17324d; background-color: #f5f5f5; cursor: pointer; transition: all 0.3s;">
                                <div class="upload-icon mb-2">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #17324d;">
                                        <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z" fill="currentColor"/>
                                        <path d="M8 15h8v2H8v-2zm0-3h8v2H8v-2zm0-3h5v2H8V9z" fill="currentColor"/>
                                    </svg>
                                </div>
                                <div class="upload-text">
                                    <p class="mb-2" id="contextUploadText">
                                        <strong>Drag context here</strong> or
                                    </p>
                                    <button type="button" class="btn btn-outline-primary btn-sm mb-2" id="contextBrowseBtn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-1">
                                            <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/>
                                        </svg>
                                        <span id="contextBrowseBtnText">Select context</span>
                                    </button>
                                </div>
                                <label for="contextFileInput" class="visually-hidden">Upload context text file</label>
                                <input type="file" name="contextUpload" id="contextFileInput" accept=".txt" style="display: none;" aria-describedby="contextLabel">
                            </div>

                            <!-- Context file preview -->
                            <div class="text-center d-none" id="contextPreviewContainer">
                                <div class="alert alert-info text-start mb-2">
                                    <strong id="contextFileName">context.txt</strong>
                                    <p class="mb-0 small" id="contextFilePreview"></p>
                                </div>
                                <div class="mt-2">
                                    <button type="button" class="btn btn-outline-danger btn-sm" id="removeContext">
                                        <svg class="icon icon-sm me-1"><use href="/bootstrap-italia/dist/svg/sprites.svg#it-delete"></use></svg>
                                        <span id="removeContextText">Remove</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Generate button -->
                    <div class="row mt-3">
                        <div class="col-12">
                            <button type="button" class="btn btn-primary btn-lg w-100" id="generateBtn" disabled>
                                <span id="btnText">Generate Alt Text</span>
                                <span class="spinner-border spinner-border-sm ms-2 d-none" id="btnSpinner" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </span>
                            </button>
                        </div>
                    </div>

                    <!-- Clear button -->
                    <div class="row mt-2">
                        <div class="col-12">
                            <button type="button" class="btn btn-danger btn-lg w-100" id="clearBtn" disabled>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                                    <path d="M3 6h18"></path>
                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                                <span>Clear All</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Section -->
    <div class="row justify-content-center d-none" id="resultSection" aria-live="polite" aria-atomic="true">
        <div class="col-12 col-md-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="callout success">
                        <label for="resultText" class="visually-hidden">Generated alternative text</label>
                        <textarea id="resultText" class="form-control mb-3" rows="4" placeholder="Generated alt text will appear here..." aria-label="Generated alternative text"></textarea>
                        <div class="text-center">
                            <button type="button" class="btn btn-primary btn-sm" id="copyBtn">
                                <svg class="icon icon-sm me-1"><use href="/bootstrap-italia/dist/svg/sprites.svg#it-copy"></use></svg>
                                <span id="copyBtnText">Copy</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Italia JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-italia@2.8.2/dist/js/bootstrap-italia.bundle.min.js"></script>

<script>
    let currentModel = 'openai-gpt4o';
    let currentLang = 'en';
    let selectedFile = null;
    let selectedContextFile = null;
    let contextText = '';
    let actualAltText = ''; // Store the actual alt text for copying
    let isAuthenticated = false;
    let loginUrl = null;

    // Initialize Bootstrap tooltips
    document.addEventListener('DOMContentLoaded', function() {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Check authentication status on page load
        checkAuthenticationStatus();
    });

    // DOM Elements
    const modelSelect = document.getElementById('modelSelect');
    const langSelect = document.getElementById('languageSelect');
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadDragdrop');
    const browseBtn = document.getElementById('browseBtn');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');
    const generateBtn = document.getElementById('generateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultSection = document.getElementById('resultSection');
    const copyBtn = document.getElementById('copyBtn');
    const removeImage = document.getElementById('removeImage');

    // Context file elements
    const contextFileInput = document.getElementById('contextFileInput');
    const contextDragdrop = document.getElementById('contextDragdrop');
    const contextBrowseBtn = document.getElementById('contextBrowseBtn');
    const contextPreviewContainer = document.getElementById('contextPreviewContainer');
    const contextFileName = document.getElementById('contextFileName');
    const contextFilePreview = document.getElementById('contextFilePreview');
    const removeContext = document.getElementById('removeContext');

    // Model selection
    modelSelect.addEventListener('change', (e) => {
        currentModel = e.target.value;
    });

    // Language selection
    langSelect.addEventListener('change', (e) => {
        currentLang = e.target.value;
    });

    // Browse button click
    browseBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        fileInput.click();
    });

    // Upload area click
    uploadArea.addEventListener('click', (e) => {
        if (e.target !== browseBtn && !browseBtn.contains(e.target)) {
            fileInput.click();
        }
    });

    // Upload area keyboard accessibility
    uploadArea.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            fileInput.click();
        }
    });

    // File input change
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFile(e.target.files[0]);
        }
    });

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = '#0052cc';
        uploadArea.style.backgroundColor = '#e6f0ff';
    });

    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = '#0066cc';
        uploadArea.style.backgroundColor = '#f0f6fc';
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = '#0066cc';
        uploadArea.style.backgroundColor = '#f0f6fc';

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFile(files[0]);
        }
    });

    function handleFile(file) {
        if (!file.type.startsWith('image/')) return;

        selectedFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
            previewImage.src = e.target.result;
            uploadArea.classList.add('d-none');
            previewContainer.classList.remove('d-none');
            generateBtn.disabled = false;
        };
        reader.readAsDataURL(file);
    }

    // Remove image
    removeImage.addEventListener('click', resetForm);

    // Context file upload handlers
    contextBrowseBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        contextFileInput.click();
    });

    contextDragdrop.addEventListener('click', () => {
        contextFileInput.click();
    });

    // Context drag-drop keyboard accessibility
    contextDragdrop.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            contextFileInput.click();
        }
    });

    contextDragdrop.addEventListener('dragover', (e) => {
        e.preventDefault();
        contextDragdrop.style.borderColor = '#0066cc';
        contextDragdrop.style.backgroundColor = '#e6f2ff';
    });

    contextDragdrop.addEventListener('dragleave', () => {
        contextDragdrop.style.borderColor = '#17324d';
        contextDragdrop.style.backgroundColor = '#f5f5f5';
    });

    contextDragdrop.addEventListener('drop', (e) => {
        e.preventDefault();
        contextDragdrop.style.borderColor = '#17324d';
        contextDragdrop.style.backgroundColor = '#f5f5f5';

        const file = e.dataTransfer.files[0];
        if (file && file.type === 'text/plain') {
            handleContextFile(file);
        }
    });

    contextFileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            handleContextFile(file);
        }
    });

    function handleContextFile(file) {
        selectedContextFile = file;
        const reader = new FileReader();

        reader.onload = (e) => {
            contextText = e.target.result;
            contextFileName.textContent = file.name;
            const preview = contextText.length > 100 ? contextText.substring(0, 100) + '...' : contextText;
            contextFilePreview.textContent = preview;
            contextPreviewContainer.classList.remove('d-none');
            contextDragdrop.classList.add('d-none');
        };

        reader.readAsText(file);
    }

    removeContext.addEventListener('click', () => {
        selectedContextFile = null;
        contextText = '';
        contextFileInput.value = '';
        contextPreviewContainer.classList.add('d-none');
        contextDragdrop.classList.remove('d-none');
    });

    function resetForm() {
        selectedFile = null;
        fileInput.value = '';
        previewContainer.classList.add('d-none');
        previewImage.src = '';
        uploadArea.classList.remove('d-none');
        selectedContextFile = null;
        contextText = '';
        contextFileInput.value = '';
        contextPreviewContainer.classList.add('d-none');
        contextDragdrop.classList.remove('d-none');
        generateBtn.disabled = true;
        resultSection.classList.add('d-none');
    }

    // API Configuration
    const API_BASE_URL = 'http://localhost:8000/api';

    // Check authentication status
    async function checkAuthenticationStatus() {
        console.log('[AUTH] Checking authentication status...');
        try {
            const response = await fetch(`${API_BASE_URL}/auth/status`);
            const data = await response.json();
            console.log('[AUTH] Status response:', data);

            if (data.authenticated && data.requires_u2a) {
                // U2A mode: check if we have valid session
                isAuthenticated = data.has_credentials;
                loginUrl = data.login_url;
                console.log('[AUTH] U2A mode - isAuthenticated:', isAuthenticated, 'loginUrl:', loginUrl);
            } else if (!data.requires_u2a) {
                // OpenAI: no user auth required
                isAuthenticated = true;
                console.log('[AUTH] OpenAI mode - no auth required');
            }
        } catch (error) {
            console.error('[AUTH] Error checking auth status:', error);
            isAuthenticated = false;
        }
    }

    // Show authentication via OAuth2 redirect
    async function showAuthentication() {
        console.log('[AUTH] showAuthentication called');
        console.log('[AUTH] loginUrl:', loginUrl);
        console.log('[AUTH] isAuthenticated:', isAuthenticated);

        // If loginUrl is not set, try to fetch auth status again
        if (!loginUrl) {
            console.log('[AUTH] Login URL not set, fetching auth status...');
            await checkAuthenticationStatus();
        }

        if (loginUrl) {
            // Redirect to OAuth2 authorization endpoint
            // This will redirect to ECB login and then back to our callback
            console.log('[AUTH] Redirecting to:', `${API_BASE_URL}${loginUrl}`);
            window.location.href = `${API_BASE_URL}${loginUrl}`;
        } else {
            console.error('[AUTH] No login URL available even after re-checking');
            alert('Authentication is required but no login URL is configured. Please check your setup and ensure the API server is running.');
        }
    }

    // Generate with real API call
    generateBtn.addEventListener('click', async () => {
        console.log('[GENERATE] Button clicked');

        // Backend handles authentication automatically via CredentialManager
        // No frontend authentication check needed
        performGeneration();
    });

    async function performGeneration() {
        const btnText = document.getElementById('btnText');
        const btnSpinner = document.getElementById('btnSpinner');

        btnText.textContent = 'Generating...';
        btnSpinner.classList.remove('d-none');
        generateBtn.disabled = true;

        try {
            // Prepare FormData
            const formData = new FormData();
            formData.append('image', selectedFile);
            formData.append('language', currentLang);
            formData.append('model', currentModel);

            if (contextText && contextText.trim()) {
                formData.append('context', contextText.trim());
            }

            // API Call
            const response = await fetch(`${API_BASE_URL}/generate-alt-text`, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            if (data.success && data.alt_text !== undefined && data.alt_text !== null) {
                actualAltText = data.alt_text; // Store actual value
                const altTextDisplay = data.alt_text === "" ? '(Empty alt text for decorative image)' : data.alt_text;
                document.getElementById('resultText').value = altTextDisplay;
                resultSection.classList.remove('d-none');
                resultSection.scrollIntoView({ behavior: 'smooth' });

                // Enable Clear button after successful generation
                clearBtn.disabled = false;
            } else {
                throw new Error(data.error || 'Failed to generate alt-text');
            }

        } catch (error) {
            console.error('Error generating alt-text:', error);
            alert(`Generation error: ${error.message}\n\nMake sure the API server is running (python backend/api.py)`);
        } finally {
            btnText.textContent = 'Generate Alt Text';
            btnSpinner.classList.add('d-none');
            generateBtn.disabled = false;
        }
    }

    // Copy result
    copyBtn.addEventListener('click', () => {
        // Copy the current value from textarea (allowing user edits)
        const textToCopy = document.getElementById('resultText').value;
        navigator.clipboard.writeText(textToCopy).then(() => {
            document.getElementById('copyBtnText').textContent = 'Copied!';
            setTimeout(() => {
                document.getElementById('copyBtnText').textContent = 'Copy';
            }, 2000);
        });
    });

    // Clear all - reset form to initial state
    clearBtn.addEventListener('click', () => {
        // Reset image upload
        selectedFile = null;
        fileInput.value = '';
        previewContainer.classList.add('d-none');
        uploadArea.classList.remove('d-none');

        // Reset context
        selectedContextFile = null;
        contextText = '';
        contextFileInput.value = '';
        contextPreviewContainer.classList.add('d-none');
        contextDragdrop.classList.remove('d-none');

        // Reset model and language to default
        modelSelect.value = 'openai-gpt4o';
        currentModel = 'openai-gpt4o';
        langSelect.value = 'en';
        currentLang = 'en';

        // Hide result section
        resultSection.classList.add('d-none');
        document.getElementById('resultText').value = '';
        actualAltText = '';

        // Disable buttons
        generateBtn.disabled = true;
        clearBtn.disabled = true;

        // Scroll back to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
</script>

        </div>
    </main>

    <!-- Live region for screen reader announcements -->
    <div role="status" aria-live="polite" aria-atomic="true" class="visually-hidden" id="announcements"></div>

</body>
</html>